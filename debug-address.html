<!DOCTYPE html>
<html>
<head>
    <title>Address Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .error { color: red; }
        .success { color: green; }
        .debug { background: #f0f0f0; padding: 10px; margin: 10px 0; }
        button { margin: 5px; padding: 10px; }
    </style>
</head>
<body>
    <h1>Address API Debug Tool</h1>
    
    <div>
        <button onclick="testAxios()">Test with axios (like frontend)</button>
        <button onclick="testFetch()">Test with fetch</button>
        <button onclick="testCORS()">Test CORS</button>
    </div>
    
    <div id="output"></div>

    <script src="https://cdn.jsdelivr.net/npm/axios/dist/axios.min.js"></script>
    <script>
        const output = document.getElementById('output');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.innerHTML = `[${new Date().toLocaleTimeString()}] ${message}`;
            output.appendChild(div);
            console.log(message);
        }

        // Create axios instance similar to frontend
        const axiosInstance = axios.create({
            baseURL: 'http://localhost:8081/api/',
            timeout: 10000
        });

        async function testAxios() {
            log('Testing axios instance with geocoding/search...');
            try {
                const response = await axiosInstance.get('geocoding/search', {
                    params: { query: 'Berlin' }
                });
                log('Axios Success: ' + JSON.stringify(response.data), 'success');
            } catch (error) {
                log('Axios Error: ' + error.message, 'error');
                log('Error details: ' + JSON.stringify({
                    status: error.response?.status,
                    statusText: error.response?.statusText,
                    headers: error.response?.headers,
                    data: error.response?.data
                }), 'error');
            }
        }

        async function testFetch() {
            log('Testing fetch with full URL...');
            try {
                const response = await fetch('http://localhost:8081/api/geocoding/search?query=Berlin');
                if (!response.ok) {
                    throw new Error(`HTTP ${response.status}: ${response.statusText}`);
                }
                const data = await response.json();
                log('Fetch Success: ' + JSON.stringify(data), 'success');
            } catch (error) {
                log('Fetch Error: ' + error.message, 'error');
            }
        }

        async function testCORS() {
            log('Testing CORS with OPTIONS request...');
            try {
                const response = await fetch('http://localhost:8081/api/geocoding/search', {
                    method: 'OPTIONS',
                    headers: {
                        'Origin': 'http://localhost:3002',
                        'Access-Control-Request-Method': 'GET',
                        'Access-Control-Request-Headers': 'Content-Type'
                    }
                });
                log('CORS Options Status: ' + response.status, response.ok ? 'success' : 'error');
                log('CORS Headers: ' + JSON.stringify(Object.fromEntries(response.headers.entries())));
            } catch (error) {
                log('CORS Error: ' + error.message, 'error');
            }
        }

        // Test on page load
        window.onload = function() {
            log('Page loaded, testing APIs...');
            testFetch();
        };
    </script>
</body>
</html>
